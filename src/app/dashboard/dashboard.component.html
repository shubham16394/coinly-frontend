<div class="border-dashboard">
  <div class="button-container">
    <button mat-raised-button class="green-button" (click)="gotoBudget()">Go to Budget</button>
    <mat-button-toggle-group
      appearance="legacy"
      name="fontStyle"
      aria-label="Font Style"
      [value]="timeFilter"
    >
      <mat-button-toggle value="daily" (click)="timeFilterChange('daily')"
        >Daily</mat-button-toggle
      >
      <mat-button-toggle value="monthly" (click)="timeFilterChange('monthly')"
        >Monthly</mat-button-toggle
      >
    </mat-button-toggle-group>
  </div>
  <div class="centered-row">
    <div class="button-container-nospace" *ngIf="timeFilter === 'daily'">
      <h4 class="margin-tb-13">
        {{ date | date : "MMM dd, yyyy" }}
      </h4>
      <input
        hidden
        matInput
        [matDatepicker]="picker"
        [(ngModel)]="date"
        (dateChange)="changeDate($event)"
      />
      <mat-datepicker-toggle
        matIconSuffix
        [for]="picker"
      ></mat-datepicker-toggle>
      <mat-datepicker #picker></mat-datepicker>
    </div>

    <div class="button-container-nospace" *ngIf="timeFilter === 'monthly'">
      <h4 class="margin-tb-13">
        {{ month | date : "MMM, yyyy" }}
      </h4>
      <input
        hidden
        matInput
        [matDatepicker]="pickerMonth"
        [(ngModel)]="month"
        (dateChange)="changeDate($event)"
      />
      <mat-datepicker-toggle
        matIconSuffix
        [for]="pickerMonth"
      ></mat-datepicker-toggle>
      <mat-datepicker
        #pickerMonth
        startView="multi-year"
        (monthSelected)="setMonthAndYear($event, pickerMonth)"
        panelClass="example-month-picker"
      >
      </mat-datepicker>
    </div>
  </div>
  <div class="button-container margin-tb">
    <mat-card>
      <mat-card-content *ngIf="timeFilter === 'daily'">
        Total Daily Budget -
        <br />
        <h1 style="color: green">{{ budget }} ₹</h1>
      </mat-card-content>
      <mat-card-content *ngIf="timeFilter === 'monthly'">
        Total Monthly Budget -
        <br />
        <h1 style="color: green">{{ budget }} ₹</h1>
      </mat-card-content>
    </mat-card>
    <mat-card>
      <mat-card-content>
        Expenses so far -
        <br />
        <h1 style="color: red">{{ expenses }} ₹</h1>
      </mat-card-content>
    </mat-card>
  </div>
  <div class="margin-tb-10 centered-row" style="color: red; font-weight: bold;">
    <mat-card>
      <mat-card-content>Your avg expense pace is more than the daily budget.</mat-card-content>
    </mat-card>
  </div>
  <div class="centered-row" *ngIf="timeFilter === 'daily'">
    <button mat-raised-button class="red-button" (click)="openAddDailyExpenseDialog()">Add Today's Expense</button>
  </div>
  <div class="margin-tb-10" *ngIf="timeFilter === 'daily'">
    <table
      mat-table
      [dataSource]="dataSource"
      multiTemplateDataRows
      class="mat-elevation-z8"
    >
      <ng-container
        matColumnDef="{{ column }}"
        *ngFor="let column of columnsToDisplay"
      >
        <th mat-header-cell *matHeaderCellDef>{{ column }}</th>
        <ng-container *ngIf="column === 'Time'">
          <td mat-cell *matCellDef="let element">
            {{ element[columnDataMap[column]] | date : "hh:mm a" }}
          </td>
        </ng-container>
        <ng-container *ngIf="column !== 'Time'">
          <td mat-cell *matCellDef="let element">
            {{ element[columnDataMap[column]] }} ₹
          </td>
        </ng-container>
      </ng-container>
      <ng-container matColumnDef="expand">
        <th mat-header-cell *matHeaderCellDef aria-label="row actions">
          &nbsp;
        </th>
        <td mat-cell *matCellDef="let element">
          <button
            mat-icon-button
            aria-label="expand row"
            (click)="
              expandedElement = expandedElement === element ? null : element;
              $event.stopPropagation()
            "
          >
            <mat-icon *ngIf="expandedElement !== element"
              >keyboard_arrow_down</mat-icon
            >
            <mat-icon *ngIf="expandedElement === element"
              >keyboard_arrow_up</mat-icon
            >
          </button>
        </td>
      </ng-container>

      <!-- Expanded Content Column - The detail row is made up of this one column that spans across all columns -->
      <ng-container matColumnDef="expandedDetail">
        <td
          mat-cell
          *matCellDef="let element"
          [attr.colspan]="columnsToDisplayWithExpand.length"
        >
          <tr class="display-block" *ngFor="let exp of element?.expenses">
            <div
              class="example-element-detail"
              [@detailExpand]="
                element == expandedElement ? 'expanded' : 'collapsed'
              "
            >
              <div class="example-element-diagram centered-row">
                <mat-chip class="green-button margin-tb-5">{{
                  exp.expType | titlecase
                }}</mat-chip>
                <div class="example-element-weight margin-tb-5">
                  {{ exp.expValue }} ₹
                </div>
                <div class="example-element-weight margin-tb-5">
                  {{ exp.expTime | date : "hh:mm a" }}
                </div>
              </div>
              <div class="example-element-description">
                <button mat-button class="green-button" (click)="editDaily(exp)">
                  Edit
                </button>
                <br />
                <br />
                <button mat-button class="red-button" (click)="deleteDaily(exp)">
                  Delete
                </button>
              </div>
            </div>
          </tr>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="columnsToDisplayWithExpand"></tr>
      <tr
        mat-row
        *matRowDef="let element; columns: columnsToDisplayWithExpand"
        class="example-element-row"
        [class.example-expanded-row]="expandedElement === element"
        (click)="expandedElement = expandedElement === element ? null : element"
      ></tr>
      <tr
        mat-row
        *matRowDef="let row; columns: ['expandedDetail']"
        class="example-detail-row"
      ></tr>
    </table>
  </div>
  <div class="margin-tb-10" *ngIf="timeFilter === 'monthly'">
    <table
      mat-table
      [dataSource]="dataSource"
      multiTemplateDataRows
      class="mat-elevation-z8"
    >
      <ng-container
        matColumnDef="{{ column }}"
        *ngFor="let column of columnsToDisplay"
      >
        <th mat-header-cell *matHeaderCellDef>{{ column }}</th>
        <ng-container *ngIf="column === 'Time'">
          <td mat-cell *matCellDef="let element">
            {{ element[columnDataMap[column]] | date : "MMM dd, yyyy" }}
          </td>
        </ng-container>
        <ng-container *ngIf="column !== 'Time'">
          <td mat-cell *matCellDef="let element">
            {{ element[columnDataMap[column]] }} ₹
          </td>
        </ng-container>
      </ng-container>
      <ng-container matColumnDef="expand">
        <th mat-header-cell *matHeaderCellDef aria-label="row actions">
          &nbsp;
        </th>
        <td mat-cell *matCellDef="let element">
          <button
            mat-icon-button
            aria-label="expand row"
            (click)="
              expandedElement = expandedElement === element ? null : element;
              $event.stopPropagation()
            "
          >
            <mat-icon *ngIf="expandedElement !== element"
              >keyboard_arrow_down</mat-icon
            >
            <mat-icon *ngIf="expandedElement === element"
              >keyboard_arrow_up</mat-icon
            >
          </button>
        </td>
      </ng-container>

      <!-- Expanded Content Column - The detail row is made up of this one column that spans across all columns -->
      <ng-container matColumnDef="expandedDetail">
        <td
          mat-cell
          *matCellDef="let element"
          [attr.colspan]="columnsToDisplayWithExpand.length"
        >
          <div
            class="centered-row"
            [@detailExpand]="
              element == expandedElement ? 'expanded' : 'collapsed'
            "
          >
            <button mat-raised-button color="accent" (click)="openAddMonthlyExpenseDialog(element?.time)">Add Expense</button>
          </div>

          <tr class="display-block" *ngFor="let exp of element?.expenses">
            <div
              class="example-element-detail centered-row"
              [@detailExpand]="
                element == expandedElement ? 'expanded' : 'collapsed'
              "
            >
              <div class="example-element-diagram centered-row">
                <mat-chip class="green-button margin-tb-5">{{
                  exp.expType | titlecase
                }}</mat-chip>
                <div class="example-element-weight margin-tb-5">
                  {{ exp.expValue }} ₹
                </div>
                <div class="example-element-weight margin-tb-5">
                  {{ exp.expTime | date : "hh:mm a" }}
                </div>
              </div>
              <div class="example-element-description">
                <button mat-button class="green-button" (click)="editMonthly(exp, element?.time)">
                  Edit
                </button>
                <br />
                <br />
                <button mat-button class="red-button" (click)="deleteMonthly(exp)">
                  Delete
                </button>
              </div>
            </div>
          </tr>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="columnsToDisplayWithExpand"></tr>
      <tr
        mat-row
        *matRowDef="let element; columns: columnsToDisplayWithExpand"
        class="example-element-row"
        [class.example-expanded-row]="expandedElement === element"
        (click)="expandedElement = expandedElement === element ? null : element"
      ></tr>
      <tr
        mat-row
        *matRowDef="let row; columns: ['expandedDetail']"
        class="example-detail-row"
      ></tr>
    </table>
  </div>
</div>
